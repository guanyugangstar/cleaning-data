# 数据清洗配置文件
# ==============================================================================
# 使用说明：
# 1. 此文件为主配置文件，建议复制为 custom.yaml 进行自定义
# 2. 脚本会自动检测空字段，大部分场景只需修改关键参数
# 3. 详细文档请参考 CLAUDE.md 和 reference/ 目录
# ==============================================================================

# ==============================================================================
# 数据路径配置
# ==============================================================================
data:
  input_path: "data/raw_data.csv"          # 输入文件路径 (支持 csv/xlsx/json/parquet)
  output_path: "data/cleaned_data.csv"     # 输出文件路径
  encoding: "utf-8-sig"                     # 文件编码 (中文CSV用 utf-8-sig)
  output_dir: "data"                        # 输出目录 (EDA报告、备份等保存位置)

# ==============================================================================
# 缺失值处理
# strategy 说明：
#   - drop: 删除含缺失值的行
#   - mean: 用均值填充 (数值列)
#   - median: 用中位数填充 (数值列，推荐)
#   - mode: 用众数填充 (分类列)
#   - fixed: 用固定值填充
# ==============================================================================
missing_values:
  # 全局策略
  strategy: "median"                        # 默认策略: drop/mean/median/mode/fixed
  fixed_value: 0                            # 当strategy=fixed时使用的固定值

  # 按列指定策略 (优先级高于全局策略)
  # 格式: {列名: 策略}
  # 示例:
  #   age: mean        # 年龄列用均值填充
  #   name: "drop"     # 名称列删除缺失行
  #   status: "fixed"  # 状态列用固定值填充
  columns: {}

# ==============================================================================
# 重复值处理
# action 说明：
#   - drop: 删除重复行 (保留第一个)
#   - keep_first: 保留第一个
#   - keep_last: 保留最后一个
# ==============================================================================
duplicates:
  action: "drop"                            # 处理方式: drop/keep_first/keep_last

  # 指定列去重 (为空则所有列完全相同才算重复)
  # 示例: subset: ["email", "phone"]  # 只看这两列是否相同
  subset: []

# ==============================================================================
# 异常值处理
# method 说明：
#   - none: 不处理
#   - iqr: 四分位距法 (默认)
#   - zscore: Z-score标准化法
#   - mad: 绝对中位差法 (对异常值更稳健)
#   - range: 范围过滤法 (需要配置ranges)
# treatment 说明：
#   - nan: 标记为缺失值
#   - clip: 截断到边界值
#   - remove: 删除行
# ==============================================================================
outliers:
  method: "iqr"                             # 检测方法: none/iqr/zscore/mad/range
  treatment: "nan"                          # 处理方式: nan/clip/remove

  # 范围过滤法需要的业务规则 (需要人工判断)
  # 格式: {列名: [最小值, 最大值]}
  # 示例:
  #   age: [0, 120]                 # 年龄 0-120
  #   score: [0, 100]               # 分数 0-100
  #   year: [1900, 2030]            # 年份范围
  #   price: [0, null]              # 价格>0 (无上限)
  ranges: {}

  # IQR方法参数
  iqr_multiplier: 1.5                       # IQR倍数因子 (默认1.5，可设为3.0减少检测)

  # Z-score参数
  zscore_threshold: 3                       # Z-score阈值 (超过此值视为异常，默认3)

  # MAD参数
  mad_threshold: 3.5                        # MAD阈值 (默认3.5)

# ==============================================================================
# 格式标准化
# ==============================================================================
format_standardization:
  # 日期列 (自动检测，可手动指定)
  # 脚本会自动识别列名含 date/time/日期/时间 或内容符合日期格式的列
  # 示例: date_columns: ["创建日期", "update_time"]
  date_columns: []

  # 文本清理 - 去除前后空格 (自动检测分类列，可手动指定)
  # 示例: trim_columns: ["name", "city", "category"]
  trim_columns: []

  # 转为小写的列
  # 示例: lowercase_columns: ["email", "country_code"]
  lowercase_columns: []

  # 转为标题格式的列 (每个单词首字母大写)
  # 示例: title_columns: ["full_name", "company_name"]
  title_columns: []

  # 需要转换为数值类型的列 (自动检测，可手动指定)
  # 会清理货币符号(¥$€)、千分位、百分号等
  # 示例: numeric_columns: ["price", "amount", "quantity"]
  numeric_columns: []

  # 删除的列 (高缺失率>50%的列会自动删除)
  # 示例: drop_columns: ["unused_column", "temp_field"]
  drop_columns: []

  # 字段值纠正 - 模糊匹配自动纠正输入错误
  # 适用于分类列存在输入变体的情况 (如"住建局限"->"住建局")
  # 格式: {列名: {allowed_values: [标准值列表], threshold: 相似度阈值}}
  # threshold 说明: 0.5-0.9，越高越严格，默认0.6
  # 示例:
  #   value_correction:
  #     部门:
  #       allowed_values: [民政局, 人社局, 市场监管局, 住建局, 税务局]
  #       threshold: 0.6
  value_correction: {}

# ==============================================================================
# 数据转换
# ==============================================================================
transformations:
  # 分类编码 (自动检测低基数列<=10个类别)
  # 格式: {列名: 编码映射} 或 {列名: "label"(自动标签编码)}
  # 示例:
  #   gender: {"male": 0, "female": 1, "other": 2}
  #   status: "label"        # 自动按字母顺序编码
  categorical_encoding: {}

  # 数值分箱 (将连续值转为分类)
  # 格式: {列名: {bins: [边界值], labels: [标签]}}
  # 示例:
  #   age:
  #     bins: [0, 18, 35, 50, 65, 120]
  #     labels: ["未成年", "青年", "中年", "壮年", "老年"]
  #   score:
  #     bins: [0, 60, 70, 80, 90, 100]
  #     labels: ["不及格", "及格", "中", "良", "优"]
  binning: {}

  # 计算列 (派生新列)
  # 格式: {新列名: 表达式}
  # 表达式支持: 列名、数学运算(+-*/)、比较(==!=<>)、逻辑(&|~)
  # 特殊支持: dt.year 提取年份
  # 示例:
  #   total_price: "price * quantity"           # 总价 = 单价 × 数量
  #   age_in_months: "age * 12"                 # 年龄转月
  #   is_adult: "age >= 18"                     # 是否成年
  #   order_year: "order_date.dt.year"          # 从日期提取年份
  #   discount_price: "price * 0.9"             # 9折价
  computed_columns: {}

# ==============================================================================
# 业务规则（预留）
# ==============================================================================
business_rules:
  enabled: false                            # 是否启用业务规则检查
  rules: []                                 # 业务规则列表 (待实现)

# ==============================================================================
# 报告配置
# ==============================================================================
report:
  verbose: true                             # 详细输出 (显示频率分布等)
  show_stats: true                          # 显示数值统计 (describe、百分位数)
  log_to_file: false                        # 是否保存日志到文件
  log_file_path: "logs/cleanling_log.txt"   # 日志文件路径
